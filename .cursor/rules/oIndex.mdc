---
description: Klick iOS camera app overview - project structure, documentation index, file locations, and essential development guidelines
alwaysApply: true
version: 1.1
lastUpdated: 2025-10-30
---

# Klick Project Rules

## ğŸ¯ Project Overview

- **Platform**: iOS 16.0+, iPhone 12+
- **Language**: Swift 5.9
- **Architecture**: MVVM + Service Layer
- **Key Frameworks**: SwiftUI, UIKit, AVFoundation, Vision, Core Image, Metal

## ğŸ“š Documentation First - ALWAYS START HERE

**Master Index**: `Documentation/0_INDEX.md`

### Quick Doc Lookup:

**Core References**:
- **Tech Stack**: `Documentation/TECH_STACK.md` - All frameworks & versions
- **Architecture**: `Documentation/2_Architecture/ARCHITECTURE_OVERVIEW.md`
- **Components**: `Documentation/2_Architecture/COMPONENT_MAP.md`
- **State Patterns**: `Documentation/2_Architecture/STATE_MANAGEMENT.md`
- **Data Flow**: `Documentation/2_Architecture/DATA_FLOW.md`

**Feature-Specific**:
- Camera: `Documentation/5_Features/CAMERA_SYSTEM.md`
- Composition: `Documentation/5_Features/COMPOSITION_ANALYSIS.md`
- Filters: `Documentation/5_Features/FILTER_SYSTEM.md`
- Photos: `Documentation/5_Features/PHOTO_MANAGEMENT.md`

**Performance**:
- Memory: `Documentation/6_Performance/MEMORY_OPTIMIZATION.md`
- Blur: `Documentation/6_Performance/BLUR_OPTIMIZATION.md`
- Processing: `Documentation/6_Performance/IMAGE_PROCESSING.md`

## ğŸ—ï¸ Core Patterns

### 1. MVVM + Service Layer

```
View (SwiftUI) â†â†’ ViewModel (ObservableObject) â†â†’ Service
```

**Example**:
- View: `ContentView.swift`
- ViewModel: `CompositionManager.swift`
- Service: `CompositionService.swift` (protocol)

### 2. Protocol-Oriented Design

**Pattern**: Define protocols for extensibility

```swift
protocol CompositionService {
    var name: String { get }
    func evaluate(...) -> CompositionResult
}
```

### 3. SwiftUI + UIKit Bridge

**Pattern**: `UIViewRepresentable` + `Coordinator` for camera

```swift
struct CameraView: UIViewRepresentable {
    class Coordinator: NSObject, AVCaptureVideoDataOutputSampleBufferDelegate { }
}
```

## ğŸ¯ Key File Locations

**Main App**:
- Entry: `Klick/KlickApp.swift`
- Main: `Klick/Camera/Screen/ContentView.swift`
- Camera: `Klick/Camera/Views/CameraView.swift`

**Managers** (Singletons):
- Photos: `Klick/PhotoManager.swift`
- Composition: `Klick/CompositionManager.swift`
- Filters: `Klick/Services/FilterManager.swift`
- Blur: `Klick/BackgroundBlurManager.swift`

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›‘ BEFORE MAKING ANY CODE CHANGES - MANDATORY CHECKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸš¨ STOP: Documentation Impact Assessment (REQUIRED)

**CRITICAL**: Before writing ANY code or making edits, assess documentation impact:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” DOCUMENTATION IMPACT ASSESSMENT (DO THIS FIRST)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Will this change affect documentation?                       â”‚
â”‚                                                              â”‚
â”‚ âœ… YES â†’ Present code plan + doc impact to user FIRST      â”‚
â”‚          Use template from documentation-sync.mdc           â”‚
â”‚          â¸ï¸  WAIT for user decision before ANY code edits   â”‚
â”‚                                                              â”‚
â”‚ âŒ NO  â†’ Proceed with code changes                         â”‚
â”‚          (minor tweaks, small bug fixes, etc.)              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**Reference**: `.cursor/rules/documentation-sync.mdc` for assessment template

## âœ… Additional Pre-Flight Checks

1. **Check feature scope**: `.cursor/rules/feature-governance.mdc` â†’ Evaluate if feature fits
2. **Check docs**: `Documentation/0_INDEX.md` â†’ Find relevant technical guide
3. **Review architecture**: `.cursor/rules/architecture.mdc` â†’ Follow MVVM patterns
4. **Check state management**: `.cursor/rules/state-management.mdc` â†’ SwiftUI state patterns
5. **Consider performance**: `.cursor/rules/performance.mdc` â†’ Threading & optimization rules
6. **Test on device**: Camera requires physical iPhone 12+

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âœ… After Making Changes (If Docs Updated)

1. **Verify documentation changes**: Review primary and secondary documentation updates
2. **Update cross-references**: Verify links and line numbers still accurate
3. **Update timestamps**: Mark "Last Updated" dates in modified docs
4. **Check for broken links**: Ensure all references are still valid

## ğŸš¨ Critical Rules

### ALWAYS:
- Use `[weak self]` in async closures
- Update UI on main thread via `DispatchQueue.main.async`
- Follow SwiftUI state patterns (@State, @StateObject, @Binding)
- Preserve frame throttling (every 3rd frame)
- Test camera features on physical device

### NEVER:
- Block main thread with heavy processing
- Create ObservableObjects with `@ObservedObject` (use `@StateObject`)
- Update SwiftUI state on background threads
- Skip frame throttling in camera processing
- Break existing performance optimizations

## ğŸ“Š Project Metrics

- **Target**: iOS 16.0+, iPhone 12+
- **Frame Processing**: 10 FPS (throttled from 30 FPS)
- **Performance**: 60% memory reduction, 10-16x blur speedup
- **Architecture**: MVVM + Service Layer, Protocol-Oriented

---

**For detailed rules**: Check `.cursor/rules/` directory
**For comprehensive docs**: Start at `Documentation/0_INDEX.md`

